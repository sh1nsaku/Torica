<!DOCTYPE html><html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ToriCa 保護者 登録/ログイン</title>
<style>
:root{--bg:#f5f7fb;--card:#fff;--muted:#6b7280;--accent:#2563eb}
body{margin:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",Meiryo,sans-serif;display:flex;min-height:100vh;align-items:center;justify-content:center;padding:20px}
.wrap{width:100%;max-width:560px;background:#fff;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:20px}
h1{margin:0 0 10px;font-size:20px}.sub{color:var(--muted);font-size:12px;margin:0 0 12px}
.tabs{display:flex;background:#f1f5f9;border-radius:12px;overflow:hidden;margin-bottom:10px}
.tab{flex:1;text-align:center;padding:10px;cursor:pointer}.tab.active{background:#fff}
.field{display:flex;flex-direction:column;gap:6px;margin:8px 0} input{padding:10px;border:1px solid #cbd5e1;border-radius:10px;font:inherit}
.btn{padding:10px 12px;border-radius:10px;border:1px solid #cbd5e1;background:#fff;cursor:pointer}
.primary{background:var(--accent);color:#fff;border-color:transparent}
.err{color:#dc2626;font-size:12px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.info{background:#eff6ff;border:1px solid #bfdbfe;border-radius:10px;padding:12px;margin:12px 0;color:#1e40af;font-size:12px}
</style>
</head><body>
<main class="wrap">
  <h1>保護者ページ</h1>
  <p class="sub">学校コード：<code>SCH-0001</code> / 学校パス：<code>PASS-0001</code>（デモ）</p>

  <div class="tabs">
    <div id="tabLogin" class="tab active">ログイン</div>
    <div id="tabReg" class="tab">新規登録</div>
  </div>

  <form id="loginForm">
    <div class="field"><label>メール</label><input id="lemail" type="email" required/></div>
    <div class="field"><label>パスワード</label><input id="lpass" type="password" required/></div>
    <button class="btn primary" type="submit">ログイン</button>
    <div id="lerr" class="err"></div>
  </form>

  <form id="regForm" style="display:none">
    <div class="info">
      ※ 新規登録では監視アカウントを作成します。<br>
      生徒の情報は登録後にダッシュボードから設定できます。
    </div>
    
    <div class="field"><label>保護者名</label><input id="rguardianName" required/></div>
    <div class="row">
      <div class="field" style="flex:1"><label>メール</label><input id="remail" type="email" required/></div>
      <div class="field" style="flex:1"><label>パスワード</label><input id="rpass" type="password" required minlength="6"/></div>
    </div>
    <div class="row">
      <div class="field" style="flex:1"><label>学校コード</label><input id="rcode" placeholder="SCH-0001" required/></div>
      <div class="field" style="flex:1"><label>学校パス</label><input id="rscpass" placeholder="PASS-0001" required/></div>
    </div>
    
    <button class="btn primary" type="submit">アカウント作成</button>
    <div id="rerr" class="err"></div>
  </form>

  <div style="margin-top:10px">
    <button class="btn" onclick="location.href='guardian.html'">ダッシュボードへ（ログイン後）</button>
  </div>
</main>

<script src="./app.js"></script>
<script>
const tabLogin=document.getElementById("tabLogin"), tabReg=document.getElementById("tabReg");
const loginForm=document.getElementById("loginForm"), regForm=document.getElementById("regForm");
tabLogin.onclick=()=>{tabLogin.classList.add("active");tabReg.classList.remove("active");loginForm.style.display="";regForm.style.display="none";}
tabReg.onclick=()=>{tabReg.classList.add("active");tabLogin.classList.remove("active");loginForm.style.display="none";regForm.style.display="";}

loginForm.onsubmit=(e)=>{e.preventDefault();
  const g=ToriCa.guardianLogin(lemail.value.trim(), lpass.value);
  if(!g){ lerr.textContent="メールまたはパスワードが違います"; return; }
  location.href="guardian.html";
};

regForm.onsubmit=(e)=>{e.preventDefault();
  const res=ToriCa.guardianRegister({
    name:rguardianName.value.trim(),
    email:remail.value.trim(), 
    pass:rpass.value,
    schoolCode:rcode.value.trim(), 
    schoolPass:rscpass.value.trim()
    // 生徒情報は削除 - 後で別途登録
  });
  if(!res.ok){ rerr.textContent=res.msg; return; }
  location.href="guardian.html";
};
</script>
</body></html>